"use strict";
// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
// SPDX-License-Identifier: Apache-2.0
Object.defineProperty(exports, "__esModule", { value: true });
exports.computeFlatItems = computeFlatItems;
exports.computeTreeItems = computeTreeItems;
function computeFlatItems(items, filterPredicate, sortingComparator) {
    if (filterPredicate) {
        items = items.filter(filterPredicate);
    }
    if (sortingComparator) {
        items = items.slice().sort(sortingComparator);
    }
    return { items, size: items.length, getChildren: () => [] };
}
function computeTreeItems(allItems, treeProps, filterPredicate, sortingComparator) {
    var _a;
    const idToChildren = new Map();
    let items = [];
    let size = allItems.length;
    for (const item of allItems) {
        const parentId = treeProps.getParentId(item);
        if (parentId === null) {
            items.push(item);
        }
        else {
            const children = (_a = idToChildren.get(parentId)) !== null && _a !== void 0 ? _a : [];
            children.push(item);
            idToChildren.set(parentId, children);
        }
    }
    const getChildren = (item) => { var _a; return (_a = idToChildren.get(treeProps.getId(item))) !== null && _a !== void 0 ? _a : []; };
    const setChildren = (item, children) => idToChildren.set(treeProps.getId(item), children);
    if (filterPredicate) {
        const filterNode = (item) => {
            const children = getChildren(item);
            const filteredChildren = children.filter(filterNode);
            size -= children.length - filteredChildren.length;
            setChildren(item, filteredChildren);
            return filterPredicate(item) || filteredChildren.length > 0;
        };
        const prevLength = items.length;
        items = items.filter(filterNode);
        size -= prevLength - items.length;
    }
    if (sortingComparator) {
        const sortLevel = (levelItems) => {
            levelItems.sort(sortingComparator);
            for (const item of levelItems) {
                sortLevel(getChildren(item));
            }
        };
        sortLevel(items);
    }
    return { items, size, getChildren };
}
